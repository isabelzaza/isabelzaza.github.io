// ---- I18N strings ----
const I18N = {
  fr: {
    "meta.title": "Maison Rouge – Guide des Invités",
    "meta.description": "Informations pour les invités de la Maison Rouge : checklist de départ, serrures, internet et télé, urgences, kayak, randonnées, grill, foyer, eau, pannes, déchets, cuisine, laveuse/sécheuse.",
    "a11y.language": "Langue",
    "header.title": "Maison Rouge – Guide des Invités",
    "nav.checklist": "Checklist départ",
    "nav.serrures": "Serrures & portes",
    "nav.locks": "Guardian Locks / Fliplock",
    "nav.internet": "Internet & Télé",
    "nav.urgences": "Urgences",
    "nav.kayak": "Kayak",
    "nav.rando": "Randonnée",
    "nav.grill": "Grill / BBQ",
    "nav.foyer": "Foyer",
    "nav.eau": "Eau",
    "nav.panne": "Panne d’électricité",
    "nav.dechets": "Poubelles / Recyclage / Compost",
    "nav.cuisine": "Cuisine",
    "nav.laveuse": "Laveuse / Sécheuse",
    "checklist.title": "À votre départ — <span class='pill'>IMPORTANT</span>",
    "checklist.reset": "Tout décocher",
    "checklist.hint": "Ceci est une liste <strong>interactive</strong> : touchez pour cocher. Vos choix restent enregistrés sur votre téléphone (localement).",
    "checklist.items.0": " <input type='checkbox' data-key='reset-state' /> Remettre la Maison Rouge dans le même état et replacer les objets, meubles et jouets au même endroit où vous les avez trouvés.",
    "checklist.items.1": " <input type='checkbox' data-key='fireplace-ashes' /> Vérifier que le feu du foyer soit complètement éteint avant votre départ. <strong>Ne JAMAIS</strong> mettre de cendres dans les poubelles régulières. Utilisez la poubelle noire à cendres dehors (juste pour les cendres, rien d’autre).",
    "checklist.items.2": " <input type='checkbox' data-key='fridge' /> Vérifier que le réfrigérateur soit vide.",
    "checklist.items.3": " <input type='checkbox' data-key='windows' /> Vérifier que toutes les fenêtres soient fermées et barrées avec les deux loquets.",
    "checklist.items.4": " <input type='checkbox' data-key='dishwasher' /> S’assurer que le lave-vaisselle soit parti si vous l’avez utilisé (nous l’<em>viderons</em>). <strong>Ne JAMAIS</strong> utiliser de savon à vaisselle régulier dans le lave-vaisselle.",
    "checklist.items.5": " <input type='checkbox' data-key='linens' /> Laisser les draps utilisés sur les lits et les serviettes utilisées par terre dans les salles de bain.",
    "checklist.items.6": " <input type='checkbox' data-key='heating-winter' /> <strong>Octobre à mai (HIVER)</strong> : remettre tous les thermostats du sous-sol et du 1<sup>er</sup> étage à <strong>15</strong> (ils peuvent rester à 0 au 3<sup>e</sup>). Les 2 calorifères du côté du lac dans la pièce principale doivent être à <strong>ON</strong> et au réglage <strong>(*)</strong>. Les autres calorifères (sous-sol et salle soleil) doivent rester fermés.",
    "checklist.items.7": " <input type='checkbox' data-key='trash' /> Vider toutes les poubelles et jeter les sacs dans les bacs à l’intérieur de l’abri à la rue. Si les bacs sont pleins, apporter à l’éco-centre (214 Chemin du Long de la Rivière, près de Patrick Morin; ouverts tous les jours sauf dimanche et lundi).",
    "checklist.items.8": " <input type='checkbox' data-key='guardian-locked' /> S’assurer que les <em>guardian locks</em> soient en position verrouillée sur toutes les portes au rez-de-chaussée et au 1<sup>er</sup> (sauf la porte d’entrée).",
    "serrures.title": "Serrure et portes",
    "serrures.li1": "Pour entrer : utiliser le code fourni, puis appuyer sur la coche.",
    "serrures.li2": "Pour barrer : appuyer sur <strong>Yale</strong> (et vérifier).",
    "locks.title": "Guardian Locks / Fliplock",
    "locks.p1": "Toutes les portes sont équipées de « guardian locks » contre les intrus et pour empêcher les enfants de sortir sans qu’on s’en rende compte.",
    "locks.p2": "Si vous avez du mal à ouvrir : <a href='https://tinyurl.com/lockguardhow' target='_blank' rel='noopener'>instructions rapides (guardian)</a>.",
    "locks.p3": "Pour la porte vers la salle de soleil : <a href='https://tinyurl.com/lockfliphow' target='_blank' rel='noopener'>instructions Fliplock</a>.",
    "internet.title": "Internet & Télé",
    "internet.li1": "<strong>Réseau Wi‑Fi</strong> : <code>Colibri</code> — <strong>Mot de passe</strong> : <code>chalet770</code>",
    "internet.li2": "Mettre le subwoofer à ON (derrière).",
    "internet.li3": "Ouvrir la télé (grande manette Samsung) et le Fire TV Stick (manette « Netflix »).",
    "internet.li4": "Ouvrir la barre de son (petite manette Samsung). Sur la télé, changer la source jusqu’à ce que le Firestick apparaisse. Barre de son sur HDMI 1.",
    "internet.li5": "Choisir l’avatar CHALET (Netflix ou Amazon Prime).",
    "internet.li6": "Location de films sur Prime : possible avec un code. <a href='tel:+16154952944'>Textez 615 495 2944</a> pour voir si disponible (remboursement requis; sans garantie).",
    "urgences.title": "Urgences",
    "urgences.li0": "Pas de ligne téléphonique — utiliser votre cellulaire.",
    "urgences.li1": "Composer <a href='tel:*4141'><strong>*4141</strong></a> en cas d’urgence.",
    "urgences.li2": "Police — poste principal Rawdon : <a href='tel:+14508342578'>450 834-2578</a>; poste secondaire St‑Donat : <a href='tel:+18194244617'>819 424-4617</a>",
    "urgences.li3": "Clinique du village : <a href='tel:+18194190123'>819-419-0123</a>",
    "urgences.li4": "Services Santé Laurentides : <a href='tel:+14505431175'>450-543-1175</a>",
    "urgences.li5": "Clinique de Santé St‑Donat : <a href='tel:+18194242793'>819-424-2793</a>",
    "urgences.li6": "Contact — Isabel Gauthier : <a href='tel:+16154952944'>615-495-2944</a> (texte préférable) · <a href='mailto:isabel.gauthier@vanderbilt.edu'>isabel.gauthier@vanderbilt.edu</a>",
    "kayak.title": "Kayak (été)",
    "kayak.p1": "Kayak 2 places sous le deck (assez lourd — il faut être 2).",
    "kayak.li1": "Clé à tête noire en plastique — dans l’étagère vitrée de la cuisine.",
    "kayak.li2": "Pagaies — dans la remise sous le deck.",
    "kayak.li3": "Vestes de sauvetage — dans la salle de bain du bas.",
    "kayak.li4": "Après usage : tout remettre à sa place et bien verrouiller le kayak.",
    "rando.title": "Randonnée pédestre",
    "rando.p1": "Plusieurs belles randonnées à St‑Donat. La plus proche : <strong>Mont Sourire</strong>.",
    "rando.p2": "À la route, marcher vers la droite jusqu’à la première entrée à gauche. Continuer ~5 min, l’entrée est à droite (évident; stationnement). Montée modérée, 25–30 min jusqu’au superbe point de vue.",
    "grill.title": "Grill / BBQ",
    "grill.li1": "Grill sur le deck — utilisable librement.",
    "grill.li2": "Si la bonbonne est vide, la remplir au village.",
    "grill.li3": "<strong>Nettoyer légèrement après usage</strong>.",
    "foyer.title": "Foyer",
    "foyer.li1": "Foyers à l’intérieur et sur la plage.",
    "foyer.li2": "Bûches supplémentaires dehors (merci d’en laisser quelques‑unes à l’intérieur si vous en prenez).",
    "foyer.li3": "Bois d’allumage — bac dans la salle d’entrée.",
    "foyer.li4": "<strong>Jamais</strong> de cendres dans les poubelles régulières.",
    "eau.title": "Eau",
    "eau.li1": "L’eau du robinet est <strong>potable</strong>.",
    "eau.li2": "Distributrice d’eau (salle d’entrée) : si vous prenez une bouteille, merci de la remplacer (ramener la vide au Metro pour la consigne de 10 $, en acheter une nouvelle et la remettre au même endroit).",
    "eau.li3": "Eau chaude pour breuvages : bouton rouge à l’arrière de la machine.",
    "panne.title": "Panne d’électricité",
    "panne.li1": "Les toilettes ne fonctionnent pas (pompe à eau électrique).",
    "panne.li2": "Deux bouteilles d’eau non potable dans la salle d’entrée pour « flusher ».",
    "dechets.title": "Poubelles / Recyclage / Compost",
    "dechets.p1": "Vider toutes les poubelles et déposer dans les bacs de l’abri à la rue. Si plein : éco‑centre (214 Chemin du Long de la Rivière; ouvert tous les jours sauf dimanche et lundi).",
    "dechets.h3r": "Recyclage — bac bleu",
    "dechets.liR1": "Verre, carton (boîtes dépliées), papier, plastique, aluminium, conserves.",
    "dechets.h3c": "Compost — bac brun",
    "dechets.liC1": "Résidus alimentaires; résidus verts de jardin.",
    "dechets.liC2": "Papier/carton souillé.",
    "dechets.liC3": "Autres matières : marc de café, sachets de thé, copeaux de bois (non traités), cendres refroidies (depuis ≥ 4 semaines).",
    "dechets.note": "<strong>Utilisez des sacs en papier / journal</strong> ou mettez en vrac. <strong>Pas de sacs de plastique compostables.</strong>",
    "cuisine.title": "Cuisine",
    "cuisine.li1": "Quelques pods Keurig disponibles; cafetière filtre (filtres dans la cache à pain).",
    "cuisine.li2": "À droite du frigo (armoire) : assortiment de thés et tisanes.",
    "cuisine.li3": "Les éléments dans les bacs blancs sont à votre disposition.",
    "cuisine.li4": "Si vous brisez quelque chose, merci de m’en informer.",
    "laveuse.title": "Laveuse / Sécheuse",
    "laveuse.li1": "Laveuse : bouton de gauche pour ON, bouton de droite jusqu’à ce que les lumières aillent à droite; relâcher (vous l’entendrez se barrer avant le démarrage).",
    "laveuse.li2": "Vidéo d’instructions : <a href='https://www.youtube.com/watch?v=1y-QQjH6DIs' target='_blank' rel='noopener'>voir sur YouTube</a>.",
    "laveuse.li3": "Après le séchage, mettre la peluche dans le sac Ziploc.",
    "footer.copy": "© Maison Rouge · Guide invités"
  },
  en: {
    "meta.title": "Maison Rouge – Guest Guide",
    "meta.description": "Information for guests at Maison Rouge: departure checklist, locks, internet & TV, emergencies, kayak, hikes, grill, fireplace, water, power outages, waste, kitchen, washer/dryer.",
    "a11y.language": "Language",
    "header.title": "Maison Rouge – Guest Guide",
    "nav.checklist": "Departure checklist",
    "nav.serrures": "Locks & doors",
    "nav.locks": "Guardian Locks / Fliplock",
    "nav.internet": "Internet & TV",
    "nav.urgences": "Emergencies",
    "nav.kayak": "Kayak",
    "nav.rando": "Hiking",
    "nav.grill": "Grill / BBQ",
    "nav.foyer": "Fireplace",
    "nav.eau": "Water",
    "nav.panne": "Power outage",
    "nav.dechets": "Trash / Recycling / Compost",
    "nav.cuisine": "Kitchen",
    "nav.laveuse": "Washer / Dryer",
    "checklist.title": "Before you leave — <span class='pill'>IMPORTANT</span>",
    "checklist.reset": "Uncheck all",
    "checklist.hint": "This is an <strong>interactive</strong> list: tap to check items. Your choices are saved on your phone (locally).",
    "checklist.items.0": " <input type='checkbox' data-key='reset-state' /> Reset the house to its original state and put objects, furniture, and toys back where you found them.",
    "checklist.items.1": " <input type='checkbox' data-key='fireplace-ashes' /> Make sure any fire is completely out before you leave. <strong>Never</strong> put ashes in regular trash. Use the black outdoor ash bin (for ashes only).",
    "checklist.items.2": " <input type='checkbox' data-key='fridge' /> Empty the refrigerator.",
    "checklist.items.3": " <input type='checkbox' data-key='windows' /> Ensure all windows are closed and locked with both latches.",
    "checklist.items.4": " <input type='checkbox' data-key='dishwasher' /> If you used the dishwasher, please start it (we’ll <em>empty</em> it). <strong>Never</strong> use regular dish soap in the dishwasher.",
    "checklist.items.5": " <input type='checkbox' data-key='linens' /> Leave used sheets on the beds and used towels on the bathroom floor.",
    "checklist.items.6": " <input type='checkbox' data-key='heating-winter' /> <strong>October–May (WINTER)</strong>: set all thermostats in the basement and 1st floor to <strong>15</strong> (they can stay at 0 on the 3rd). The 2 heaters on the lake side of the main room should be <strong>ON</strong> and set to <strong>(*)</strong>. Other heaters (basement and sunroom) should remain off.",
    "checklist.items.7": " <input type='checkbox' data-key='trash' /> Empty all trash bins and place bags in the curbside shed containers. If full, take to the Eco‑Centre (214 Chemin du Long de la Rivière; open daily except Sunday and Monday).",
    "checklist.items.8": " <input type='checkbox' data-key='guardian-locked' /> Make sure the <em>guardian locks</em> are locked on all doors on the ground and 1st floors (except the front door).",
    "serrures.title": "Locks & doors",
    "serrures.li1": "To enter: use the code provided, then press the checkmark.",
    "serrures.li2": "To lock: press <strong>Yale</strong> (and verify).",
    "locks.title": "Guardian Locks / Fliplock",
    "locks.p1": "All doors have guardian locks to deter intruders and prevent children from exiting unnoticed.",
    "locks.p2": "If the door is hard to open: <a href='https://tinyurl.com/lockguardhow' target='_blank' rel='noopener'>quick instructions (guardian)</a>.",
    "locks.p3": "For the sunroom door: <a href='https://tinyurl.com/lockfliphow' target='_blank' rel='noopener'>Fliplock instructions</a>.",
    "internet.title": "Internet & TV",
    "internet.li1": "<strong>Wi‑Fi network</strong>: <code>Colibri</code> — <strong>Password</strong>: <code>chalet770</code>",
    "internet.li2": "Turn the subwoofer ON (switch on the back).",
    "internet.li3": "Turn on the TV (big Samsung remote) and the Fire TV Stick (remote with “Netflix”).",
    "internet.li4": "Turn on the soundbar (small Samsung remote). On the TV, change the <strong>source</strong> until the Firestick appears. Soundbar on <strong>HDMI 1</strong>.",
    "internet.li5": "Choose the <strong>CHALET</strong> profile (Netflix or Amazon Prime).",
    "internet.li6": "Movie rentals on Prime: available with a code. <a href='tel:+16154952944'>Text 615‑495‑2944</a> to ask if available (reimbursement required; not guaranteed).",
    "urgences.title": "Emergencies",
    "urgences.li0": "No landline — use your mobile.",
    "urgences.li1": "Dial <a href='tel:*4141'><strong>*4141</strong></a> in an emergency.",
    "urgences.li2": "Police — Rawdon main: <a href='tel:+14508342578'>450‑834‑2578</a>; St‑Donat substation: <a href='tel:+18194244617'>819‑424‑4617</a>",
    "urgences.li3": "Village clinic: <a href='tel:+18194190123'>819‑419‑0123</a>",
    "urgences.li4": "Santé Laurentides services: <a href='tel:+14505431175'>450‑543‑1175</a>",
    "urgences.li5": "St‑Donat Health Clinic: <a href='tel:+18194242793'>819‑424‑2793</a>",
    "urgences.li6": "Contact — Isabel Gauthier: <a href='tel:+16154952944'>615‑495‑2944</a> (text preferred) · <a href='mailto:isabel.gauthier@vanderbilt.edu'>isabel.gauthier@vanderbilt.edu</a>",
    "kayak.title": "Kayak (summer)",
    "kayak.p1": "Two‑seater kayak under the deck (heavy — two people required).",
    "kayak.li1": "Black plastic‑head key — in the glass kitchen cabinet.",
    "kayak.li2": "Paddles — in the shed under the deck.",
    "kayak.li3": "Life jackets — in the downstairs bathroom.",
    "kayak.li4": "After use: return everything and lock the kayak securely.",
    "rando.title": "Hiking",
    "rando.p1": "Many nice hikes around St‑Donat. The closest: <strong>Mont Sourire</strong>.",
    "rando.p2": "From the road, walk right to the first left. Continue ~5 min; trailhead is on the right (obvious; parking). Moderate climb, 25–30 min to a great viewpoint.",
    "grill.title": "Grill / BBQ",
    "grill.li1": "Grill on the deck — free to use.",
    "grill.li2": "If the tank is empty, refill it in town.",
    "grill.li3": "<strong>Please clean lightly after use</strong>.",
    "foyer.title": "Fireplace",
    "foyer.li1": "Fireplaces inside and on the beach.",
    "foyer.li2": "Extra logs outside (please leave a few inside if you bring some in).",
    "foyer.li3": "Kindling — bin in the entry room.",
    "foyer.li4": "<strong>Never</strong> put ashes in regular trash.",
    "eau.title": "Water",
    "eau.li1": "Tap water is <strong>drinkable</strong>.",
    "eau.li2": "Water dispenser (entry): if you use a jug, please replace it (return the empty to Metro for the $10 deposit, buy a new one, and put it back).",
    "eau.li3": "Hot water for drinks: red switch on the back of the machine.",
    "panne.title": "Power outage",
    "panne.li1": "Toilets won’t work (electric water pump).",
    "panne.li2": "Two jugs of non‑potable water in the entry for flushing.",
    "dechets.title": "Trash / Recycling / Compost",
    "dechets.p1": "Empty all trash bins and place bags in the curbside shed containers. If full: Eco‑Centre (214 Chemin du Long de la Rivière; open daily except Sunday and Monday).",
    "dechets.h3r": "Recycling — blue bin",
    "dechets.liR1": "Glass, cardboard (boxes <em>flattened</em>), paper, plastic, aluminum, cans.",
    "dechets.h3c": "Compost — brown bin",
    "dechets.liC1": "Food scraps; green yard waste.",
    "dechets.liC2": "Soiled paper/cardboard.",
    "dechets.liC3": "Also: coffee grounds, tea bags, untreated wood shavings, <em>cooled ashes</em> (≥ 4 weeks).",
    "dechets.note": "<strong>Use paper/newspaper bags</strong> or place items loose. <strong>No compostable plastic bags.</strong>",
    "cuisine.title": "Kitchen",
    "cuisine.li1": "Some Keurig pods available; drip coffee maker (filters in the bread bin).",
    "cuisine.li2": "Right of the fridge (cabinet): selection of teas and herbal teas.",
    "cuisine.li3": "Items in the white bins are yours to use.",
    "cuisine.li4": "If something breaks, please let me know.",
    "laveuse.title": "Washer / Dryer",
    "laveuse.li1": "Washer: left knob to ON, right knob until the lights move to the right; release (you’ll hear it lock before starting).",
    "laveuse.li2": "How‑to video: <a href='https://www.youtube.com/watch?v=1y-QQjH6DIs' target='_blank' rel='noopener'>see on YouTube</a>.",
    "laveuse.li3": "After drying, put the lint in the Ziploc bag.",
    "footer.copy": "© Maison Rouge · Guest guide"
  }
};

// ---- Language handling ----
const LANG_KEY = "maisonrouge:lang";

function getPreferredLang() {
  const saved = localStorage.getItem(LANG_KEY);
  if (saved && (saved === "fr" || saved === "en")) return saved;
  const navLang = (navigator.language || "fr").toLowerCase();
  return navLang.startsWith("fr") ? "fr" : "en";
}

function setLang(lang) {
  localStorage.setItem(LANG_KEY, lang);
  document.documentElement.setAttribute("lang", lang);
  applyI18n(lang);
}

function applyI18n(lang) {
  const dict = I18N[lang] || I18N.fr;

  // Elements with data-i18n (textContent)
  document.querySelectorAll("[data-i18n]").forEach(el => {
    const key = el.getAttribute("data-i18n");
    if (dict[key] !== undefined) {
      // Some targets include HTML (e.g., strong tags); those use data-i18n but already contain markup in dict.
      // To be safe, if current content includes HTML entities, we still set innerHTML.
      el.innerHTML = dict[key];
    }
  });

  // Elements explicitly marked for HTML replacement
  document.querySelectorAll("[data-i18n-html]").forEach(el => {
    const key = el.getAttribute("data-i18n-html");
    if (dict[key] !== undefined) el.innerHTML = dict[key];
  });

  // Attribute updates (meta description)
  document.querySelectorAll("[data-i18n-attr]").forEach(el => {
    const spec = el.getAttribute("data-i18n-attr"); // e.g., "content:meta.description"
    const [attr, k] = spec.split(":");
    if (attr && k && dict[k] !== undefined) {
      el.setAttribute(attr, dict[k]);
    }
  });

  // Title
  if (dict["meta.title"]) document.title = dict["meta.title"];

  // Update reset button text for screen readers (already covered via data-i18n)
}

// ---- Mobile nav toggle ----
const menuToggle = document.getElementById("menuToggle");
const siteNav = document.getElementById("siteNav");
if (menuToggle && siteNav) {
  menuToggle.addEventListener("click", () => {
    const isOpen = siteNav.classList.toggle("open");
    menuToggle.setAttribute("aria-expanded", isOpen ? "true" : "false");
  });
}

// ---- Smooth scroll ----
document.querySelectorAll('a[href^="#"]').forEach(a => {
  a.addEventListener("click", (e) => {
    const id = a.getAttribute("href");
    const el = document.querySelector(id);
    if (el) {
      e.preventDefault();
      el.scrollIntoView({ behavior: "smooth", block: "start" });
    }
    if (siteNav && siteNav.classList.contains("open")) {
      siteNav.classList.remove("open");
      menuToggle.setAttribute("aria-expanded", "false");
    }
  });
});

// ---- Checklist persistence ----
const checklist = document.getElementById("departureChecklist");
if (checklist) {
  const storageKey = (k) => `maisonrouge:${k}`;

  // Initialize from storage
  checklist.querySelectorAll('input[type="checkbox"][data-key]').forEach(cb => {
    const key = storageKey(cb.dataset.key);
    const val = localStorage.getItem(key);
    cb.checked = val === "1";
    cb.addEventListener("change", () => {
      localStorage.setItem(key, cb.checked ? "1" : "0");
    });
  });

  // Reset button
  const resetBtn = document.getElementById("resetChecklist");
  if (resetBtn) {
    resetBtn.addEventListener("click", () => {
      checklist.querySelectorAll('input[type="checkbox"][data-key]').forEach(cb => {
        cb.checked = false;
        localStorage.setItem(storageKey(cb.dataset.key), "0");
      });
    });
  }
}

// ---- Language switch element ----
const langSel = document.getElementById("langSwitch");
const initial = getPreferredLang();
langSel.value = initial;
setLang(initial);

langSel.addEventListener("change", () => {
  setLang(langSel.value);
});
